<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Clever | Portal</title>
  <link rel="icon" href="https://assets.clever.com/launchpad/4cfe59076/favicon.ico" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
/* Basic Reset and Body Styling */
html, body {
  margin: 0;
  padding: 0;
  background: #000;
  color: #f5f5f5;
  font-family: 'Poppins', sans-serif;
}

/* Floating, rounded, see-through, foggy top dock */
#dock {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  display: flex;
  justify-content: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  background: rgba(17, 17, 17, 0.6);
  border-radius: 50px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.2);
}

/* Main content container with top margin to avoid being covered by dock */
#widget-host {
  margin-top: 80px; /* adjust as needed based on dock height */
  min-height: calc(100vh - 80px);
  padding: 1rem;
}

/* Styles for the announcement overlay, matching dock style */
#announcement {
  position: fixed;
  top: 100px; /* position below the dock */
  right: 20px;
  max-width: 250px;
  background: rgba(17, 17, 17, 0.6);
  color: #fff;
  padding: 12px 15px;
  border-radius: 24px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.2);
  display: flex;
  flex-direction: column;
  font-family: 'Poppins', sans-serif;
  font-size: 0.9rem;
  line-height: 1.2;
  z-index: 1100;
}

/* Header inside announcement box */
#announcement h4 {
  margin-top: 0;
  margin-bottom: 8px;
  font-size: 1rem;
  font-weight: 600;
  text-align: center;
}

/* Close button style, made larger */
#announcement .close-btn {
  align-self: flex-end;
  background: transparent;
  border: none;
  color: #ff1100;
  font-size: 1.8rem; /* increased from 1.2rem to 1.8rem */
  cursor: pointer;
  margin-top: 0;
}

    /* Button and SVG styles for dock buttons */
    .dock-btn-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .dock-btn {
      width: 48px;
      height: 48px;
      padding: 8px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 12px;
      transition: background .2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dock-btn:hover {
      background: rgba(255,255,255,.1);
    }

    .dock-btn svg {
      width: 24px;
      height: 24px;
    }

    .dock-btn svg,
    .dock-btn svg * {
      stroke: #fff !important;
    }
    .dock-btn svg [fill="none"],
    .dock-btn svg [stroke="none"] {
      fill: none !important;
      stroke: none !important;
    }

    .btn-label {
      position: absolute;
      top: 100%;
      margin-top: 6px;
      background: rgba(0,0,0,.8);
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s;
    }

    .dock-btn-wrapper:hover .btn-label {
      opacity: 1;
    }

    #loader {
      text-align: center;
      padding: 2rem;
      font-size: 1.2rem;
    }
    
      close-bt {
     font-size: 17px;
    }
  </style>
</head>
<body>

<div id="dock"></div>
<div id="loader">Loadingâ€¦</div>
<div id="widget-host"></div>

<div id="announcement" style="display:none;">
  <h4>Announcement!</h4>
    <button class="close-btn" id="close-announcement"><close-bt>Click here to Close.</close-bt></button>
  <div id="announcement-text">Loading announcement...</div>
</div>

<script>
const dockItems = [
  {
    name: "Home",
    icon: "data:image/svg+xml;charset=utf-8,%3Csvg%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M10%2020v-6h4v6h5v-8h3L12%203%202%2012h3v8z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E",
    url: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/main/home.html"
  },
  {
    name: "Games",
    icon: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/refs/heads/main/icons/games.svg",
    url: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/main/games.html"
  },
  {
    name: "PC Games",
    icon: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/refs/heads/main/icons/pc-games.svg",
    url: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/main/pc-games.html"
  },
  {
    name: "Unblockers",
    icon: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/refs/heads/main/icons/unblock.svg",
    url: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/main/unbl0ck.html"
  },
  {
    name: "Recommend a game",
    icon: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/refs/heads/main/icons/recommend.svg",
    url: `new-tab: true;https://bazinga.great-site.net/recommend.php`
  },
  {
    name: "Report a broken game",
    icon: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/f7d2f049e75010f8acf622c1e46b3b180d45e363/icons/report-game.svg",
    url: `new-tab: true;https://bazinga.great-site.net/broken-game.php`
  },
  {
    name: "Changelogs",
    icon: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/refs/heads/main/icons/changelogs.svg",
    url: "https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/main/changelogs.html"
  }
];

const dock = document.getElementById('dock');
const host = document.getElementById('widget-host');
const loader = document.getElementById('loader');
const announcementDiv = document.getElementById('announcement');
const announcementText = document.getElementById('announcement-text');
const closeBtn = document.getElementById('close-announcement');

/* ðŸ”¹ Helper function: append timestamp to every fetch */
function fetchWithTimestamp(url, options = {}) {
  try {
    const separator = url.includes('?') ? '&' : '?';
    const fullUrl = `${url}${separator}t=${Date.now()}`;
    return fetch(fullUrl, options);
  } catch (err) {
    console.error("Timestamp fetch error:", err);
    return fetch(url, options);
  }
}

async function svgToInline(url){
  try{
    const res = await fetchWithTimestamp(url), text = await res.text();
    const svg = new DOMParser().parseFromString(text,'image/svg+xml').querySelector('svg');
    if(!svg) return null;
    if(!svg.hasAttribute('viewBox')){
      const w = svg.getAttribute('width')||24, h = svg.getAttribute('height')||24;
      svg.setAttribute('viewBox',`0 0 ${w} ${h}`);
    }
    svg.removeAttribute('width'); svg.removeAttribute('height');
    svg.style.cssText = 'width:24px;height:24px';
    return svg;
  }catch{return null}
}

function loadWidget(url){
  const raw = url.trim();
  const match = raw.match(/new-tab\s*:\s*true\s*;\s*(.+)/i);
  if(match){                  
    window.open(match[1].trim(),'_blank');
    return;
  }
  loader.style.display = 'block';
  host.innerHTML = '';
  fetchWithTimestamp(raw)
    .then(r=>r.text())
    .then(html=>{
      host.innerHTML = html;
      host.querySelectorAll('script').forEach(old=>{
        const fresh = document.createElement('script');
        if(old.src) fresh.src = old.src;
        else fresh.textContent = old.textContent;
        [...old.attributes].forEach(a=>fresh.setAttribute(a.name,a.value));
        old.replaceWith(fresh);
      });
    })
    .catch(err=>host.innerHTML = `<p style="text-align:center;padding:3rem">Error loading widget: ${err.message}</p>`)
    .finally(()=>loader.style.display = 'none');
}

/* ðŸ”¹ Updated to fetch JSON with timestamp */
function fetchAnnouncement() {
  fetchWithTimestamp('https://raw.githubusercontent.com/Calvin99Cooler/bazinga-games/main/announcement.json')
    .then(res => res.json())
    .then(data => {
      if (data && data.announcement && data.announcement.trim()) {
        announcementText.textContent = data.announcement;
        announcementDiv.style.display = 'flex';
      }
    })
    .catch(() => {
      // Optional error handling
    });
}

closeBtn.onclick = () => {
  announcementDiv.style.display = 'none';
};

/* Build Dock */
dockItems.forEach(item => {
  const wrap = document.createElement('div');
  wrap.className = 'dock-btn-wrapper';

  const btn = document.createElement('button');
  btn.className = 'dock-btn';
  svgToInline(item.icon).then(svg => {
    if (svg) btn.appendChild(svg);
    else btn.innerHTML = 'âš ï¸';
  });
  btn.onclick = () => loadWidget(item.url);

  const lbl = document.createElement('span');
  lbl.className = 'btn-label';
  lbl.textContent = item.name;

  wrap.append(btn, lbl);
  dock.appendChild(wrap);
});

// auto-load home
loadWidget(dockItems[0].url);

// fetch and show announcement on load
fetchAnnouncement();

/* Add message for Games section */
const gamesWrap = Array.from(dock.children).find(child => {
  const label = child.querySelector('.btn-label');
  return label && label.textContent === 'Games';
});

if (gamesWrap) {
  const button = gamesWrap.querySelector('button');
  button.addEventListener('click', () => {
    alert("Please report any broken games you find and check the changelogs to see if its been fixed");
  });
}
</script>
</body>
</html>
